 const handleSubmit = async (e) => {
        e.preventDefault();
        setSubmitStatus("loading");

        try {
            const formDataToSend = new FormData();


            const filteredPersonalInfo = {
                ...formData.formulaireVisa
            };

            const filteredResident = {
                ...formData.resident,
                body: {
                    military: formData.resident.body.military.isOk === "oui" ? formData.resident.body.military : { isOk: "non", dev: [] },
                    temoin: formData.resident.body.temoin.isOk === "oui" ? formData.resident.body.temoin : { isOk: "non", dev: [] },
                    affiliation: formData.resident.body.affiliation.isOk === "oui" ? formData.resident.body.affiliation : { isOk: "non", dev: [] },
                    charges: formData.resident.body.charges.isOk === "oui" ? formData.resident.body.charges : { isOk: "non", dev: [] },
                    voyages: formData.resident.body.voyages.isOk === "oui" ? formData.resident.body.voyages : { isOk: "non", dev: [] }
                }
            };

            const applicationData = {
                recipientEmail: formData.selectedRecipient,
                formulaireVisa: filteredPersonalInfo,
                resident: filteredResident,
                familyInfo: formData.familyInfo,
                declarationAgreed: formData.declarationAgreed,
                documents: formData.documents.map(section => ({
                    id: section.id,
                    titre: section.titre,
                    corps: section.corps.map(doc => ({
                        id: doc.id,
                        titre: doc.titre,
                        provided: doc.provided,
                        required: doc.required
                    }))
                }))
            };

            formDataToSend.append('applicationData', JSON.stringify(applicationData));

            formData.documents.forEach((section, sectionIndex) => {
                section.corps.forEach((doc, docIndex) => {
                    if (doc.provided && doc.file) {
                        formDataToSend.append(`documents[${section.id}][${doc.id}]`, doc.file);
                    }
                });
            });

            console.log(formData);

            await submitCombinedApplication(formDataToSend);
            setSubmitStatus("success");
            setSubmittedData(applicationData);
        } catch (error) {
            console.error("Erreur de soumission:", error);
            setSubmitStatus("error");
        }
    };